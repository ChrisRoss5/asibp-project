<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css"
    />
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>ASIBP Projekt</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        height: 100vh;
        margin: 0;
        background: radial-gradient(#fff, transparent),
          conic-gradient(
            #fff,
            #02bd7e,
            #db4437,
            #720e9e,
            #2f2f2f,
            #333333,
            #3b5998,
            #55acee,
            #fff
          );
      }
      h1 {
        text-align: center;
        padding: 20px 0;
      }
      #main {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #box {
        background: #fff;
        
      }
      #login {
        position: absolute;
        width: 100%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      #logout {
        text-align: center;
        padding: 0.5rem 1rem;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h1>ASIBP Projekt</h1>
    <div id="login">
      <div id="firebaseui-auth-container"></div>
    </div>
    <div id="main">
      <div id="box">
        <div id="message"></div>
        <div id="logout">Odjava</div>
      </div>
    </div>

    <script type="module">
      import "https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js";
      import "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics-compat.js";
      import "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth-compat.js";
      import "https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js";
      // https://firebase.google.com/docs/web/setup#available-libraries
      const firebaseConfig = {
        apiKey: "AIzaSyBVNXCezi1-APmjlIlLz2gjqKOPjdlWFn4",
        authDomain: "test-c3ebf.firebaseapp.com",
        databaseURL:
          "https://test-c3ebf-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "test-c3ebf",
        storageBucket: "test-c3ebf.appspot.com",
        messagingSenderId: "820675617398",
        appId: "1:820675617398:web:4ab0bd506a6a5894a5f557",
        measurementId: "G-DFS7DWMTB1",
      };
      const app = firebase.initializeApp(firebaseConfig);
      const analytics = app.analytics();
      const auth = app.auth();
      const database = app.database();
      const ui = new firebaseui.auth.AuthUI(auth);

      // Elements
      const [login, main, message, logout] = document.querySelectorAll(
        "#login, #main, #message, #logout"
      );

      // Auth
      auth.onAuthStateChanged((user) => {
        if (user) {
          // https://firebase.google.com/docs/reference/js/firebase.User
          console.log("USER HERE", user);
          database.ref("users/" + user.uid).on("value", (snapshot) => {
            message.textContent = snapshot.val();
          });
        } else {
          // https://firebase.google.com/docs/auth/web/firebaseui
          ui.start("#firebaseui-auth-container", {
            signInOptions: [
              "google.com",
              "twitter.com",
              "facebook.com",
              "github.com",
              "microsoft.com",
              "yahoo.com",
              "password",
              "phone",
            ],
            callbacks: {
              signInSuccessWithAuthResult: (authResult, redirectUrl) => {
                if (authResult.additionalUserInfo.isNewUser) {
                  database
                    .ref("users/" + authResult.user.uid)
                    .set(
                      "This message is synced with Firebase Realtime Database and accessible only to you."
                    );
                }
                return false;
              },
            },
          });
        }
      });

      logout.onclick = () =>
        auth.signOut().then(() => {
          message.textContent = "You have been signed out.";
        });
    </script>
  </body>
</html>
